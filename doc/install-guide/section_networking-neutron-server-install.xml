<?xml version="1.0" encoding="UTF-8"?>
<section xmlns="http://docbook.org/ns/docbook"
    xmlns:xi="http://www.w3.org/2001/XInclude"
    xmlns:xlink="http://www.w3.org/1999/xlink" version="5.0"
    xml:id="install_neutron_server">
    <title>Install neutron-server</title>
    <para>The <systemitem class="service"
        >neutron-server</systemitem> handles OpenStack Networking's
        user requests and exposes the API.<procedure>
            <title>To install the neutron-server</title>
            <step>
                <para>Install neutron-server and CLI for accessing the
                    API:</para>
                <screen><prompt>$</prompt><userinput>sudo apt-get install neutron-server python-neutronclient</userinput> </screen>
            </step>
            <step>
                <para>You must also install the plugin you choose to use,
                    for example:</para>
                <screen><prompt>$</prompt><userinput>sudo apt-get install neutron-plugin-&lt;plugin-name&gt;</userinput></screen>
                <!--<para>See
              <xref linkend="flexibility"/>.</para>-->
            </step>
            <step>
                <para>Most plugins require that you install a database and
                    configure it in a plugin configuration file. For
                    example:</para>
                <screen><prompt>$</prompt><userinput>sudo apt-get install mysql-server python-mysqldb python-sqlalchemy</userinput></screen>
                <para>If you already use a database for other OpenStack
                    services, you only need to create a neutron
                    database:</para>
                <screen><prompt>$</prompt><userinput>mysql -u &lt;user&gt; -p &lt;pass&gt; -e “create database neutron”</userinput></screen>
            </step>
            <step>
                <para>Configure the database in the plugin’s configuration
                    file:</para>
                <substeps>
                    <step>
                        <para>Find the plugin configuration file in
                            <filename>/etc/neutron/plugins/&lt;plugin-name&gt;</filename>
                            (for example,
                            <filename>/etc/neutron/plugins/openvswitch/ovs_neutron_plugin.ini</filename>).
                        </para>
                    </step>
                    <step>
                        <para>Set in the file:</para>
                        <screen><computeroutput>sql_connection = mysql://&lt;user&gt;:&lt;password&gt;@localhost/neutron?charset=utf8</computeroutput></screen>
                    </step>
                </substeps>
            </step>
        </procedure></para>
    <section xml:id="rpc_setup">
        <title>RPC Setup</title>
        <para>Many OpenStack Networking plugins use RPC to enable
            agents to communicate with the main <systemitem
                class="service">neutron-server</systemitem> process. If
            your plugin requires agents, they can use the same RPC
            mechanism used by other OpenStack components like Nova.</para>
        <para>
            <procedure>
                <title>To use RabbitMQ as the message bus for RPC</title>
                <step>
                    <para>Install RabbitMQ on a host reachable through the
                        management network (this step is not necessary if
                        RabbitMQ has already been installed for another
                        service, like Compute):</para>
                    <screen><prompt>$</prompt><userinput>sudo apt-get install rabbitmq-server</userinput>
<prompt>$</prompt><userinput>rabbitmqctl change_password guest &lt;password&gt;</userinput></screen>
                </step>
                <step>
                    <para>Update
                        <filename>/etc/neutron/neutron.conf</filename> with
                        the following values:</para>
                    <screen><computeroutput>rabbit_host=&lt;mgmt-IP-of-rabbit-host&gt; rabbit_password=&lt;password&gt; rabbit_userid=guest</computeroutput></screen>
                </step>
            </procedure>
        </para>
        <important>
            <para>The <filename>/etc/neutron/neutron.conf</filename>
                file should be copied to and used on all hosts running
                <systemitem class="service">neutron-server</systemitem>
                or any <systemitem class="service"
                    >neutron-*-agent</systemitem> binaries.</para>
        </important>
    </section>
    <section xml:id="openvswitch_plugin">
        <title>Plugin Configuration: OVS Plugin</title>
        <para>If you use the Open vSwitch (OVS) plugin in a deployment
            with multiple hosts, you will need to use either tunneling
            or vlans to isolate traffic from multiple networks.
            Tunneling is easier to deploy because it does not require
            configuring VLANs on network switches.</para>
        <para>The following procedure uses tunneling:</para>
        <!--<para>See
          <xref linkend="ch_adv_config"/> for more
         advanced deployment options:
         </para>-->
        <para>
            <procedure>
                <title>To configure OpenStack Networking to use the OVS
                    plugin</title>
                <step>
                    <para>Edit
                        <filename>/etc/neutron/plugins/openvswitch/ovs_neutron_plugin.ini
                        </filename> to specify the following values (for
                        database configuration, see <xref
                            linkend="install_neutron_server"/>):</para>
                    <screen><computeroutput>enable_tunneling=True tenant_network_type=gre tunnel_id_ranges=1:1000 # only required for nodes running agents local_ip=&lt;data-net-IP-address-of-node&gt;</computeroutput></screen>
                </step>
                <step>
                    <para>If you are using the neutron DHCP agent, add the
                        following to
                        <filename>/etc/neutron/dhcp_agent.ini</filename>:</para>
                    <screen><computeroutput>dnsmasq_config_file=/etc/neutron/dnsmasq-neutron.conf</computeroutput></screen>
                </step>
                <step>
                    <para>Create
                        <filename>/etc/neutron/dnsmasq-neutron.conf</filename>,
                        and add the following values to lower the MTU size on
                        instances and prevent packet fragmentation over the
                        GRE tunnel:</para>
                    <screen><computeroutput>dhcp-option-force=26,1400</computeroutput></screen>
                </step>
                <step>
                    <para>After performing that change on the node running
                        <systemitem class="service"
                            >neutron-server</systemitem>, restart <systemitem
                                class="service">neutron-server</systemitem> to pick
                        up the new settings:</para>
                    <screen><prompt>$</prompt><userinput>sudo service neutron-server restart</userinput></screen>
                </step>
            </procedure>
        </para>
    </section>
</section>