<section xmlns="http://docbook.org/ns/docbook"
         xmlns:xi="http://www.w3.org/2001/XInclude"
         xmlns:xlink="http://www.w3.org/1999/xlink"
         version="5.0"
         xml:id="nova-kvm">
  <title>Enabling KVM on the Compute Node</title>
    <para>
        The OpenStack Compute Service requires hardware virtualization support
        and certain kernel modules. Follow this procedure to determine whether
        your system has hardware virtualization support and the correct kernel
        modules available.
    </para>
    <para>
        All steps listed must be performed while logged into the system as the
        <systemitem>root</systemitem> user.
    </para>
    <procedure>
        <step>
            <para>
                Use the <command>grep</command> command to check for the
                presence of the <literal>svm</literal> or <literal>vmx</literal>
                CPU extensions by inspecting the <filename>/proc/cpuinfo</filename>
                file generated by the kernel:
            </para>
            <screen><prompt>#</prompt> <userinput><command>grep -E 'svm|vmx' /proc/cpuinfo</command></userinput></screen>
            <para>
                If any output is shown after running this command then the CPU
                is hardware virtualization capable and the functionality is
                enabled in the system BIOS.
            </para>
            <para>
                If output is <emphasis>not</emphasis> shown then consult your
                system documentation to ensure that your CPU and motherboard
                support hardware virtualization. Verify that any relevant
                hardware virtualization options are enabled in the system BIOS.
            </para>
        </step>
        <step>
            <para>
                Use the <command>lsmod</command> command to list the loaded
                kernel modules and verify that the <literal>kvm</literal>
                modules are loaded:
            </para>
            <screen><prompt>#</prompt> <userinput><command>lsmod | grep kvm</command></userinput></screen>
            <para>
                If the output includes <systemitem>kvm_intel</systemitem> or
                <systemitem>kvm_amd</systemitem> then the <systemitem>kvm</systemitem>
                hardware virtualization modules are loaded and your kernel meets
                the module requirements for the OpenStack Compute Service.
            </para>
            <para>If the output does not appear to have the kvm module loaded,
            you should be able to load it with:</para>
            <screen><prompt>#</prompt> <userinput><command>modprobe -a kvm</command></userinput></screen>
            <para>then for your particular CPU, choose either intel:
            <screen><prompt>#</prompt> <userinput><command>modprobe -a kvm-intel</command></userinput></screen>
            or amd:</para>
            <screen><prompt>#</prompt> <userinput><command>modprobe -a kvm-amd</command></userinput></screen>
            <para>However, as kvm installation may change the groups your user is
            a member of, you may need to re-login for changes to take effect.
            </para>
        </step>
    </procedure>
    <para>
        This completes the required checks to ensure hardware virtualization
        support is available and enabled, and that you have the correct kernel
        modules loaded.
    </para>
    <para>
        If the checks indicated that either hardware virtualization support or
        the required kernel modules are not available or not enabled then you
        must take action to either find a system that does have the required
        hardware virtualization support and modules, or enable it on the system
        that failed the checks.
    </para>
</section>
