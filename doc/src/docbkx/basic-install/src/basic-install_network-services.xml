<?xml version="1.0" encoding="UTF-8"?>
<section xmlns="http://docbook.org/ns/docbook"
    xmlns:xi="http://www.w3.org/2001/XInclude"
    xmlns:xlink="http://www.w3.org/1999/xlink" version="5.0"
    xml:id="basic-install_network-services">
    <title>Network Services</title>
    <section xml:id="network-ovs">
    <title>Open-vSwitch</title>
    <para>
        <orderedlist>
            <listitem>
                <para>Install the packages
                        :<screen os="ubuntu"><userinput>apt-get install quantum-plugin-openvswitch-agent \
quantum-dhcp-agent quantum-l3-agent</userinput></screen><screen os="centos;rhel;fedora"><userinput>yum install openstack-quantum openstack-quantum-openvswitch\
openvswitch-switch</userinput></screen></para><para os="centos;rhel;fedora">The Open vSwitch kernel module in Fedora
                        has been compiled without tunnel support. If
                        gre tunnels and network namespaces are
                        desired, then this package must be recompiled
                        from source. Directions can be found on the
                        Open vSwitch site. If the kernel module is
                        recompiled then the existing one must be
                        removed and deleted.</para>
            </listitem>
            <listitem>
                <para>Start Open vSwitch:
                    <screen>service openvswitch-switch start</screen><screen os="centos;rhel;fedora">chkconfig openvswitch-switch on</screen></para>
            </listitem>
            <listitem>
                <para>Create Virtual
                        Bridging:<screen>ovs-vsctl add-br br-int
ovs-vsctl add-br br-ex
ovs-vsctl add-port br-ex eth2
ip link set up br-ex </screen></para>
            </listitem>
            <listitem><para>A crucial step for configuring Open vSwitch and the Linux bridge
                        means you must move your IP address to the
                        bridge interface instead of the physical
                        interface. This is described below and also in
                <link linkend="basic-network-common">Common services</link>.</para> 
                <para>As an example, if you tie eth0 to a bridge, such
                        as <userinput>ovs-vsctl add-br br-eth0
                            &amp;&amp; ovs-vsctl add-port br-eth0
                            eth0</userinput> (where eth0 had an IP
                        address of 192.168.100.51/24), then you need
                        to modify your
                            <filename>/etc/network/interfaces</filename>
                        as such:</para>
            <screen>
auto eth0
iface eth0 inet manual
up ifconfig $IFACE up
up ip link $IFACE promisc on
down ifconfig $IFACE down

auto br-eth0
iface br-eth0 inet static
address 192.168.100.51
netmask 255.255.255.0
gateway 192.168.100.X
dns-nameservers 8.8.8.8
            </screen></listitem>
            </orderedlist>
    </para>
    </section>
    <section xml:id="network-quantum">
        <title>Quantum</title>
            <para>Configure Quantum services:</para>
            <itemizedlist>
                <listitem>
                    <para>Edit <emphasis role="bold">/etc/quantum/l3_agent.ini</emphasis> file and modify :<screen><userinput>auth_url = http://192.168.0.1:35357/v2.0
admin_tenant_name = service
admin_user = quantum 
admin_password = password
metadata_ip = 192.168.0.1
use_namespaces = False</userinput></screen></para>
                </listitem>
                <listitem>
                <para>Edit <emphasis role="bold"
                        >/etc/quantum/api-paste.ini</emphasis> file
                    and
                    modify:<screen><userinput>
auth_host = 192.168.0.1
admin_tenant_name = service
admin_user = quantum
admin_password = password</userinput></screen></para>
                </listitem>
                <listitem>
                    <para>Edit <emphasis role="bold"
                        >/etc/quantum/quantum.conf</emphasis> file and
                    modify:<screen><userinput>core_plugin = \
    quantum.plugins.openvswitch.ovs_quantum_plugin.OVSQuantumPluginV2
auth_strategy = keystone
fake_rabbit = False
rabbit_host = 192.168.0.1
rabbit_password = password</userinput></screen></para>
                </listitem>
                <listitem>
                    <para>Edit <emphasis role="bold"
                        >/etc/quantum/plugins/openvswitch/ovs_quantum_plugin.ini</emphasis>
                    file and modify:<screen>[DATABASE]
sql_connection = mysql://quantum:password@192.168.0.1:3306/quantum
[OVS]
tenant_network_type = gre 
tunnel_id_ranges = 1:1000
enable_tunneling = True
integration_bridge = br-int
tunnel_bridge = br-tun
local_ip = 10.10.10.1</screen>
                    <db:note xmlns:db="http://docbook.org/ns/docbook">
                        <db:para>It's more handy to choose <emphasis
                                role="bold">tunnel mode</emphasis>
                            since you don't have to configure your
                            physical switches for VLANs.</db:para>
                    </db:note></para>
                </listitem>
                <listitem>
                    <para>Edit <emphasis role="bold"
                        >/etc/quantum/dhcp_agent.ini</emphasis> file
                    and
                    add:<screen><userinput>use_namespaces = False</userinput></screen></para>
                </listitem>
            </itemizedlist>

            <para>Start the
            services:<screen os="ubuntu">service quantum-plugin-openvswitch-agent start
service quantum-dhcp-agent restart
service quantum-l3-agent restart</screen><screen os="centos;rhel;fedora">service quantum-server restart
service quantum-openvswitch-agent restart
service quantum-dhcp-agent restart
service quantum-l3-agent restart
chkconfig quantum-server on
chkconfig quantum-openvswitch-agent on
chkconfig quantum-dhcp-agent on
chkconfig quantum-l3-agent on</screen></para>
        
    </section>
</section>
