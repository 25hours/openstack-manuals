<?xml version="1.0" encoding="UTF-8"?>
<section xmlns="http://docbook.org/ns/docbook"
    xmlns:xi="http://www.w3.org/2001/XInclude"
    xmlns:xlink="http://www.w3.org/1999/xlink" version="5.0"
    xml:id="admin_cli_manage_projects_users">
    <title>Manage projects and users</title>
    <para>In an OpenStack cloud, you can manage projects and users
        independently from each other.</para>
    <para>Projects represent different organizational units in the
        cloud to which you can assign users.</para>
    <para>Cloud admin users perform both project and user management
        tasks.</para>
    <para>During the basic system set up, the cloud operator must
        define at least one project, user, and role. The operator
        links the role to the user and the user to the project. Roles
        define which actions users can perform.</para>
    <para>The <filename>python-keystoneclient</filename> provides the
        keystone command-line client, which you use to manage projects
        and users from any machine outside the cloud. Before you can
        run commands, you must download and source an OpenStack RC
        file. See <xref linkend="cli_openrc"/>.</para>
    <note>
        <title>Administrator credentials</title>
        <para>To administer projects and users, you must have
            administrator credentials. Make sure to download and
            source the OpenStack RC file as administrator before you
            run keystone commands. Alternatively, export the
            respective environment variables by using the token or
            password authentication method. For details, see <link
                xlink:href="http://docs.openstack.org/essex/openstack-compute/admin/content/adding-users-tenants-and-roles-with-python-keystoneclient.html"
                >http://docs.openstack.org/essex/openstack-compute/admin/content/adding-users-tenants-and-roles-with-python-keystoneclient.html</link>.</para>
    </note>
    <section xml:id="admin_cli_projects">
        <title>Create and manage projects</title>
        <procedure>
            <title>To list all projects</title>
            <step>
                <para>To list all projects with their ID, name, and
                    whether they are enabled or not, run the following
                    command:</para>
                <screen><prompt>$</prompt> <userinput>keystone tenant-list</userinput></screen>
            </step>
        </procedure>
        <procedure>
            <title>To create a project</title>
            <step>
                <screen><prompt>$</prompt> <userinput>keystone tenant-create --name PROJECT_NAME </userinput></screen>
                <para>Creates a new project with the specified name.
                </para>
            </step>
        </procedure>
        <procedure>
            <title>To temporarily disable a project</title>
            <step>
                <screen><prompt>$</prompt> <userinput>keystone tenant-update PROJECT_ID --enabled false</userinput></screen>
               <!-- <para>For the details of the impact, see <xref
                        linkend="dashboard_manage_projects_users"/>.
                </para>-->
            </step>
        </procedure>
        <procedure>
            <title>To delete a project</title>
            <step>
                <screen><prompt>$</prompt> <userinput>keystone tenant-delete PROJECT_ID </userinput></screen>
                <para>Deletes the specified project.</para>
            </step>
        </procedure>
    </section>
    <section xml:id="admin_cli_user_accounts">
        <title>Create and manage user accounts</title>
        <procedure>
            <title>To list all users</title>
            <step>
                <screen><prompt>$</prompt> <userinput>keystone user-list</userinput></screen>
                <para>Lists all user accounts with their ID, name,
                    e-mail address, and the information if they are
                    enabled or not.</para>
            </step>
        </procedure>
        <procedure>
            <title>To create a user account</title>
            <step>
                <screen><prompt>$</prompt> <userinput>keystone user-create --name USER_NAME --tenant_id PROJECT_ID --pass PRELIM_PASSWD</userinput></screen>
                <para>Creates a new user with the specified name.
                    While the only required argument is --name, at
                    least specify the optional parameters --tenant_id
                    and --pass. Otherwise the newly created user
                    cannot log in to the SUSE Cloud Dashboard.</para>
            </step>
        </procedure>
        <procedure>
            <title>To temporarily disable a user account</title>
            <step>
                <screen><prompt>$</prompt> <userinput>keystone user-update USER_ID --enabled false</userinput></screen>
                <para>If you disable a user account, the user can no
                    longer log in, but his data is kept so that the
                    account can be re-enabled at any time.</para>
            </step>
        </procedure>
        <procedure>
            <title>To delete a user account</title>
            <step>
                <screen><prompt>$</prompt> <userinput>keystone user-delete USER_ID </userinput></screen>
                <para>Deletes the specified user account.</para>
            </step>
        </procedure>
    </section>
    <section xml:id="admin_cli_roles">
        <title>Create and manage roles</title>
        <para>Roles define the actions that the user is allowed to
            perform. Configure roles in OpenStack Identity (Keystone).
            Actions are defined per OpenStack service in the
            respective /etc/[SERVICE_CODENAME]/policy.json file, for
            example in /etc/nova/policy.json for the Compute (Nova)
            service.</para>
        <procedure>
            <title>To list all roles</title>
            <step>
                <screen><prompt>$</prompt> <userinput>keystone role-list</userinput></screen>
                <para>Lists all roles with their ID and name.</para>
            </step>
        </procedure>
        <procedure>
            <title>To create a role</title>
            <step>
                <screen><prompt>$</prompt> <userinput>keystone role-create --name=ROLE_NAME </userinput></screen>
                <para>Creates a role with the specified name.</para>
            </step>
        </procedure>
        <procedure>
            <title>To delete a role</title>
            <step>
                <screen><prompt>$</prompt> <userinput>keystone role-delete ROLE_ID </userinput></screen>
                <para>Deletes the specified role.</para>
            </step>
        </procedure>
    </section>
    <section xml:id="admin_cli_modify_projects">
        <title>Modify user assignments for a project</title>
        <para>Whereas each user is assigned to a primary project when
            his user account is created, users can be members of
            multiple projects. The keystone client does not allow to
            directly assign users to additional projects. Instead you
            need to define a role and grant that role to a
            user-project pair.</para>
        <procedure>
            <title>To modify user assignments for a project</title>
            <step>
                <para>On a shell, source the OpenStack RC file. For
                    details, refer to <link
                        xlink:href="https://www.suse.com/documentation/suse_cloud10/book_cloud_admin/data/sec_adm_cli_rc.html"
                        >OpenStack RC File</link>.</para>
            </step>
            <step>
                <para>Check if there is already a member role defined:</para>
                <screen><prompt>$</prompt> <userinput>keystone role-list</userinput></screen>
            </step>
            <step>
                <para>If not, create it:</para>
                <screen><prompt>$</prompt> <userinput>keystone role-create --name=member</userinput></screen>
            </step>
            <step>
                <para>To grant the role to a user-project pair (and to
                    thus assign a user to this project), you need to
                    know the IDs of the role, the user, and the
                    project. You can look them up with keystone
                    role-list, keystone user-list, and keystone
                    tenant-list.</para>
            </step>
            <step>
                <para>To grant the user membership of a project:</para>
                <screen><prompt>$</prompt> <userinput>keystone user-role-add --role-id=ROLE_ID --tenant_id=TENANT_ID \
  --user_id=USER_ID</userinput></screen>
            </step>
            <step>
                <para>To assign the user to multiple projects, repeat
                    the last step.</para>
            </step>
            <step>
                <para>To verify the assignments, use:</para>
                <screen><prompt>$</prompt> <userinput>keystone user-role-list --user_id=USER_ID --tenant_id=TENANT_ID </userinput></screen>
            </step>
        </procedure>
    </section>
</section>
